# リファクタリング記録 (2026-02-10)

## 概要
アプリケーションの保守性と拡張性を向上させるため、フロントエンドのコンポーネント分割とRust側のタイマー精度の向上を行いました。

## 変更点

### 1. フロントエンド構成の再構築
巨大化していた `src/App.tsx` を以下の役割ごとに分割しました。

- **Hooks (ロジックの分離)**
    - `src/hooks/usePresets.ts`: プリセットの読み込み、保存、削除などのデータ管理。
    - `src/hooks/useTimer.ts`: タイマーの状態管理、開始・停止・リセット、Tauriバックエンドとの通信。

- **Components (UIの分離)**
    - `src/components/SetupView.tsx`: タイマー設定画面。プリセット選択や時間入力を行う。
    - `src/components/TimerView.tsx`: タイマー実行画面。残り時間の表示と操作ボタンを提供する。
    - `src/components/PresetManager.tsx`: プリセットの新規作成・編集・削除を行う管理画面。

- **その他**
    - `src/types.ts`: `Preset`, `TimerStage` などの型定義を集約。
    - `src/constants.ts`: 定数定義を集約。

### 2. タイマー精度の向上 (Rust)
`src-tauri/src/timer.rs` のタイマー処理において、単純な `sleep` ループから `tokio::time::interval` を使用する方式に変更しました。

- **改善前**: `sleep(1s)` をループさせる方式。処理時間の累積により、長時間動作時に時間が遅れる（ドリフトする）可能性があった。また、開始直後に即座に1秒減る挙動となっていた。
- **改善後**: `tokio::time::interval` を使用。ドリフト補正が行われるため精度が向上。また、最初の1秒待機後に減算を開始するようにロジックを修正し、自然なカウントダウン動作とした。

## 新機能の追加 (2026-02-10)

### 1. ショートカットキー (2A)
プレゼンターが手元を見ずに操作できるよう、以下のキーに対応しました。
- `Space`: タイマーの開始 / 停止
- `Enter`: 次のステージへ進む
- `R`: 現在のステージをリセット
- `Esc`: タイマーを終了して設定画面に戻る（または全画面解除）
※入力フォームにフォーカスがある場合は誤動作防止のため無効化されます。

### 2. 通知音のプリセット (1B)
Web Audio APIを用いて、4種類の通知音を選択できるようになりました。
- **標準**: 従来のサイン波ビープ音
- **電子音**: 矩形波を用いた硬い音
- **ベル風**: 減衰の長い落ち着いた音
- **チャイム風**: 2音を組み合わせた通知音
設定は `settings.json` に保存され、次回起動時も維持されます。

### 3. 全画面プレゼンモード (3B)
タイマー画面に「全画面表示」ボタンを追加しました。
- 実行するとウィンドウがフルスクリーンになり、操作ボタン類が非表示になります。
- 残り時間が画面いっぱいに拡大表示されるため、遠くからでも視認しやすくなります。
- `Esc` キーで通常モードに戻ることができます。
